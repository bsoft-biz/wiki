# Трассировка



1. Определить sid и serial\# нужной сессии. \(v$session\)

2. Включить трассировку: 

Вместо sid, serial\# - значения, найденные на первом шаге.

```sql
begin 
dbms_system.set_ev(sid,serial#,10046,12,''); 
end;
```

\(вызвать предыдущее НЕ с 12, а с 8; а потом по окончании выполнения проблемного действия,   alter session set session\_cached\_cursors = 0;  -- закрытие кэшированных курсоров\)

--4 bind-переменные

--8 блокировки

Трассировку желательно включить непосредственно перед выполнением проблемного действия.

3. Выполнить проблемное действие в программе.

4. Дождаться окончания работы в приложении и закрыть программу \(завершить сессию\).

Если не завершить сессию \(не закрыть программу\), то часть ценной информации не попадёт в трэйс-файл.

5. Проверить, сформировался ли трэйс-файл в папке udump.

- Найти путь к udump можно так:

```sql
select value from v$parameter where name='user_dump_dest'
```

- Трэйс должен содержать строку вида:

\*\*\* SESSION IDemoticon\_unhappysid.serial\#\)  &lt;дата и время&gt;

где sid и serial\# - из первого пункта

- Если трэйс не сформировался, необходимо повторить процедуру.

Возможно, была некорректно идентифицирована нужная сессия.

6. Обработать полученный файл при помощи tkprof.

Необходимо получить 4 файла, обработанных tkprof - без сортировки, с сортировкой sort=prsela, sort=exeela, sort=fchela.

Пример: \(имя файла трассировки - catalog\_ora\_2384.trc\)

Вызов tkprof из командной строки:

При каждом вызове необходимо указывать новое имя файла, чтобы не перекрыть уже имеющиеся.

Удобно добавлять суффикс с первой буквой параметра сортировки.

1\) tkprof catalog\_ora\_2384.trc catalog\_ora\_2384.out sys=no

2\) tkprof catalog\_ora\_2384.trc catalog\_ora\_2384\_p.out sys=no sort=prsela

3\) tkprof catalog\_ora\_2384.trc catalog\_ora\_2384\_e.out sys=no sort=exeela

4\) tkprof catalog\_ora\_2384.trc catalog\_ora\_2384\_f.out sys=no sort=fchela

7. Для дальнейшего анализа нужны все полученные на выходе tkprof файлы и файл трассировки.

Доп. информация: http://www.sql.ru/faq/faq\_topic.aspx?fid=389

--

изменить путь к udump можно с помощью

```sql
alter system set user_dump_dest ='\\Work-fc67b62689\Shares\dump_test'
```

--

анализируем максимальный elapsed

Смотри на количество чтений, затраченное на разных этапах время, количество обработанных строк, методы доступа, способы соединения и т.д.

--

\\orasvr\docs\Dima\Sorted\Oracle & SQL\К.Миллсап, Д.Хольт - Oracle. Оптимизация призводительности.pdf

