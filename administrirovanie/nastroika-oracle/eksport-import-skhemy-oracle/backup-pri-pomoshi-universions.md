# BackUp при помощи uniVersions

  
----------------------------------------------------------------

Резервное копирование базы данных при помощи un4Versions.exe

----------------------------------------------------------------

Резервное копирование заключается в ежедневном создании файла,

в котором запакованы следующие данные:

- результаты полного экспорта всей БД \(файлы \*.dmp и \*.log\)

- результат анализа структуры всех схем БД \(файл \*.xml\)

- папка с клиентской частью программы Universal Accounting

- папка с шаблонами отчетов и печатных форм документов и форм

Настройка резервного копирования выполняется в три шага:

Шаг 1. Формирование командной строки

Шаг 2. Создание пакетного командного файла

Шаг 3. Создание задания для планировщика

----------------------------------------------------------------

Подробное описание каждого шага настройки:

----------------------------------------------------------------

Шаг 1. Формирование командной строки

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

- Запустить программу un4Versions.exe

- Открыть страницу "Командный режим" \(вкладка "Команды"\)

- Выбрать команду ExpFull

- Ввести или выбрать параметр Src \(например, un4/un4:sys/sys@ORA64\)

  Здесь первая схема \(un4/un4 - логин/пароль\) роли не играет, так как

  не используется и присутствует только для общности формата строки.

  Можно указать только :sys/sys@ORA64 \(важно двоеточие в начале строки\)

  Можно даже короче - :/sys@ORA64 или просто @ORA64 \(если пароль - sys\)

  Для случая нестандартного пароля на схему sys \(например, 12345\)

  параметр Src надо записать так: :/12345@ORASTD

  Можно избежать процесса ручного ввода этого параметра, нажав одну из

  кнопок справа от поля ввода параметра

- Ввести параметр file \(например, ora64-{yymmdd} - имя сервера и дата\)

  Использование формата {yymmdd} в имени файла позволяет создавать

  разные имена файлов архива в разные дни, чтобы они могли лежать

  в одном каталоге \(папке\) одновременно. Порядок год-месяц-день нужен

  для правильной сортировки файлов при просмотре папке - сортировка

  по имени файла даст фактически сортировку по дате архивации

  Если не вводить параметр file, программа использует XXXX-{yymmdd-hhmm}

  где XXXX - имя сервера Oracle \(в имя файла попадет также и время архива\)

  Если расширение файла не указано, программа использует \*.pak \(стандарт\)

- Ввести или выбрать параметр path \(например, E:\Archives\)

  Если папка архивации не указана, программа использует каталог запуска

- Ввести или выбрать параметр dir \(например, DATA\_PUMP\_DIR\)

  Имя используемого каталога особенной роли не играет, так как программа

  использует его временно, перенося файлы в каталог из параметра path

  Важно, чтобы существовал объект Oracle Directory с указанным именем,

  и чтобы он указывал на реально существующий каталог операционной системы,

  куда имеются права на запись файлов

  Если параметр dir не указан, программа использует значение DATA\_PUMP\_DIR

- Ввести или выбрать параметр good \(папка программы Universal Accounting\)

  Если этот параметр не указан, папка с программой не архивируется

  Если указать значение ? \(вопросительный знак\), в архив попадет папка,

  из которой запущена программа un4Versions.exe \(каталог запуска\)

- Ввести или выбрать параметр tmpl \(папка с шаблонами отчетов и печатных форм\)

  Если этот параметр не указан, папка с шаблонами не архивируется

- Для проверки правильности задания параметров нажать кнопку "Выполнить!",

  дождаться успешного завершения экспорта и открыть полученный файл архива

  в программе WinRar, WinZIP или любой другой, понимающей формат файлов ZIP

- Если при экспорте произошла ошибка или в файле архива отсутствуют какие-то

  фрагменты архива \(там должны быть файлы \*dmp, \*.log, \*.xml, а также папки

  с программой Universal Accounting и с шаблонами отчетов и печатных форм\),

  то разобраться с причиной, исправить параметры и повторить экспорт

- Если экспорт прошел без ошибок, и в файле архива присутствуют все файлы,

  которые там должны находиться, то надо скопировать параметры из поля ввода

  справа от кнопки "Выполнить!" и использовать их в пакетном командном файле

Шаг 2. Создание пакетного командного файла

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Считаем, что имеется готовая строка параметров, полученная на Шаге 1.

Например, это строка может выглядеть так:

/expfull src=@ORA64 file=ora64-{yymmdd} path=E:\Archives good=? tmpl=X:\templates

- Создать новый текстовый файл, переименовав его в arc-full.bat

- Написать в файле имя программы un4Versions.exe с указанием полного пути

  \(например, D:\Good\un4Versions.exe\)

- В той же строке через пробел вставить строку параметров из Шага 1.

- Сохранить файл и закрыть редактор

- Для проверки выполнить файл вручную, дождаться завершения и проверить архив

Шаг 3. Создание задания для планировщика

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

В зависимости от версии и языка интерфейса операционной системы планировщик

может называться "Scheduler" или "Назначенные задания" - важно создать новое

задание, которое будет запускаться ежедневно ночью и выполнять тот файл,

который мы создали на Шаге 2.

