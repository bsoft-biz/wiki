# Создание отчета

###  **1. Создание узла отчета \(конфигуратор\)**

Целью данной инструкции является создание отчета с произвольными параметрами в формате Formula One. \(DLL ID = 9002, ReportID = univ\).

Найдя подходящий отчет, копируем его с помощью

![](../.gitbook/assets/copy.png)

![](../.gitbook/assets/9%20%281%29.png)

 Выйдет сообщение о завершении экспорта одного узла. Нажимаем

![](../.gitbook/assets/ok%20%289%29.png)

![](../.gitbook/assets/11%20%282%29.png)

 Выбираем журнал и вставляем узел с помощью

![](../.gitbook/assets/paste.png)

![](../.gitbook/assets/new-subnode.png)

 В результате чего объект будет вставлен как подузел.

![](../.gitbook/assets/12%20%281%29.png)

 Получаем сообщение о завершении импорта одного узла. Нажимаем

![](../.gitbook/assets/ok%20%2818%29.png)

![](../.gitbook/assets/13%20%282%29.png)

 Нажимаем на кнопку

![](../.gitbook/assets/node.png)

![](../.gitbook/assets/14.png)

 В открывшемся окне переименовываем название отчета \(Тестовый отчет\) и _Section \(RPT\_BS\_BOOK\_TEST\),_ \(по желанию можно задать перевод на английском и румынском\) и нажимаем

![](../.gitbook/assets/ok%20%2814%29.png)

![](../.gitbook/assets/15.png)

 В поле

![](../.gitbook/assets/template.png)

 указываем имя шаблона \(bs\_book\_rep\_test.vts\), который мы скопировали и нажимаем

![](../.gitbook/assets/ok%20%283%29.png)

![](../.gitbook/assets/16.png)

 В поле

![](../.gitbook/assets/sqlallinone.png)

 записан блок _PL/SQL_ для отчета который мы скопировали. Необходимо создать свой пакет с процедурой.

![](../.gitbook/assets/17.png)

###  **2. Создание шаблона**

 Для начала выбираем похожий шаблон. Открываем папку с шаблонами template, находим файлы формата _.vts._ Шаблон откроется в программе _Formula One_.

![](../.gitbook/assets/2%20%282%29.png)

Копируем нужный файл и тут же вставляем. После чего переименовываем шаблон \(в данном случае это _bs\_book\_rep\_test.vts\)._ При открытии файла откроется полная копия скопированного файла. В процессе редактирования называем наш отчет "Выдача топлива". В поле \_company выводится имя компании. Поля _\_datastart_ и _\_dataend_ образуют период. В поле _\_clcavtot_ выводится название автомобиля из справочника _VMS\_UNIVERS_. _detail1_ образуют 4 поля \(в _\_avto_ попадает код автомобиля из справочника _VMS\_UNIVERS_; в _\_clcavtot_ попадает название автомобиля из справочника _VMS\_UNIVERS_; в поле \_cant попадает количество, в поле _txtcoment_ комментарий\). Напротив summary ведется подсчет всех строк в поле с двойным \(!\)  нижним подчеркиванием _\_\_cant_. Напротив _title_ задаются названия.

![](../.gitbook/assets/8%20%283%29.png)

###  **3. Создание пакета**

 Открываем _Toad_ и в редакторе записываем скрипт создания пакета _pkg\_bs\_book\_reps_ и процедуры _test_. Выполняем и компилируем скрипт с помощью кнопки

![](../.gitbook/assets/compile%20%281%29.png)

![](../.gitbook/assets/18%20%283%29.png)

В процедуре приравниваем для _Header'a_ поля с именем компании из таблицы _VMS\_COMPANY_, дату начала и дату конца. Для _filt1_ подселектом из справочника _VMS\_UNIVERS_ в поле _clcavtot_ будет выводиться название автомобиля.

Для _Master'a_ приравниваем поля с кодом автомобиля, его названием, количеством, комментарием, _datamanual_ \(период от _:datastart_ до _:dataend_\) и кодом документа. Где _nrdoc_ _Master'a_ равен коду документа, _nrdoc_ _Detail'a_ равен коду документа, _sysfid_ документа равен 10, _cod_ _Detail'a_ приравниваем к _filt1_ и используем нулевые значения. Выполняем и компилируем скрипт с помощью кнопки

![](../.gitbook/assets/compile.png)

![](../.gitbook/assets/19%20%282%29.png)

 Завершаем транзакцию с сохранением с помощью кнопки  **Commit**.

![](../.gitbook/assets/commit%20%287%29.png)

![](../.gitbook/assets/20-5.png)

###  **4. Создание запроса**

 В поле

![](../.gitbook/assets/sqlallinone%20%281%29.png)

 записываем название только что созданного пакета _pkg\_bs\_book\_reps_ и через точку название процедуры _test_. После чего нажимаем

![](../.gitbook/assets/ok%20%2811%29.png)

![](../.gitbook/assets/20.png)

 Сохраняем изменения посредством **Commit**.

![](../.gitbook/assets/commit2.png)

![](../.gitbook/assets/21%20%281%29.png)

###  **5. Изменение шаблона**

 Для того чтобы изменения вступили в силу обновляем настройки с помощью кнопки _F5_. В появившемся окне нажимаем

![](../.gitbook/assets/yes%20%287%29.png)

![](../.gitbook/assets/22.png)

 После чего получаем сообщение об успешном обновлении настроек. Нажимаем

![](../.gitbook/assets/ok%20%2816%29.png)

![](../.gitbook/assets/23.png)

 Открываем дерево отчетов и находим тестовый отчет в журнале _Доходы_. Нажимаем правой кнопкой мыши и выбираем

![](../.gitbook/assets/admin.panel%20%281%29.png)

![](../.gitbook/assets/24%20%281%29.png)

 В открывшейся вкладке выбираем

![](../.gitbook/assets/design%20%281%29.png)

![](../.gitbook/assets/25%20%281%29.png)

 Для _filt1Caption:TLabel_ задаём в поле _Caption_ "Автомобиль".

![](../.gitbook/assets/26%20%281%29.png)

 Для _filt1:TUnDBEdit_ в поле _Params_ задаём фильтр выпадающего справочника. Для этого нажимаем на

![](../.gitbook/assets/mnogotochie.png)

![](../.gitbook/assets/27%20%281%29.png)

 В открывшемся окне вводим фильтр, благодаря которому из справочника будет выпадать только список автомобилей. Нажимаем

![](../.gitbook/assets/ok2%20%281%29.png)

![](../.gitbook/assets/28.png)

 После чего закрываем окно

![](../.gitbook/assets/kh.png)

![](../.gitbook/assets/29%20%281%29.png)

 И сохраняем изменения с помощью кнопки

![](../.gitbook/assets/save%20%282%29.png)

![](../.gitbook/assets/30%20%281%29.png)

 В появившемся окне нажимаем

![](../.gitbook/assets/ok%20%282%29.png)

![](../.gitbook/assets/31.png)

 Нажав на 

![](../.gitbook/assets/mnogotochie%20%2811%29.png)

 выпадает справочник с автомобилями.

![](../.gitbook/assets/33.png)

 Выбираем например Икарус 280 и нажимаем

![](../.gitbook/assets/postroit%20%281%29.png)

 \(или горячую клавишу F9\).

![](../.gitbook/assets/34.png)

 В результате чего построится отчет.

![](../.gitbook/assets/35.png)

###  **6. Изменение шаблона**

 Откроем наш шаблон и изменим поля title на группировку GroupH \(Header\) по полю \_cod и GroupF \(Footer\). Так же добавим переход на новую страницу pagebreak. Таким образом будет происходить переход на новую страницу сразу после названия компании \(\_company\) и после шапки \(код, автомобиль, кол-во и комментарий\). Для сохранения изменений нажимаем на кнопку

![](../.gitbook/assets/sokhranit.png)

![](../.gitbook/assets/36.png)

 Для того чтобы увидеть изменения необходимо построить новый отчет, либо воспользоваться кнопкой  обновить отчет

![](../.gitbook/assets/obnovit-otchet.png)

 \(если отчет уже построен\).

![](../.gitbook/assets/37.png)

 Можно строить отчеты для разных документов, которые будут отличаться по \_cod от datamanual и считать итоги до документу с помощью поля с двойным \(!\) нижним подчеркиванием \(\_\_cant\). Сохраняем изменения с помощью кнопки

![](../.gitbook/assets/sokhranit%20%281%29.png)

![](../.gitbook/assets/38.png)

 При обновлении отчета, будет построен отчет для двух документов \(от 13.10.2013 и 26.10.2013\) и для каждого ведется подсчет итогов.

![](../.gitbook/assets/39.png)

 Так же можно изменять внешний вид отчета. Для этого необходимо выделить нужные поля и нажав левой кнопкой мыши в меню выбрать

![](../.gitbook/assets/format-cells%20%281%29.png)

![](../.gitbook/assets/40.png)

 Перейдя на вкладку

![](../.gitbook/assets/patterns%20%281%29.png)

 можно выбрать цвет окна ниже 

![](../.gitbook/assets/fil-color%20%281%29.png)

 Выберем например цвет

![](../.gitbook/assets/cvet.png)

 ниже

![](../.gitbook/assets/fil-pattern%20%281%29.png)

 выбираем цвет

![](../.gitbook/assets/cvet-2.png)

 \(ниже Sample показан выбранный цвет\) и нажимаем

![](../.gitbook/assets/ok2%20%282%29.png)

![](../.gitbook/assets/41.png)

 В результате выделенные поля будут в новом цвете. После проделанных операций сохраняем изменения с помощью кнопки 

![](../.gitbook/assets/sokhranit%20%284%29.png)

![](../.gitbook/assets/42.png)

 В результате отчет примет вид.

![](../.gitbook/assets/44.png)

 При включении свойства SetRowHeightAuto on, в отчете будет устанавливаться автоматическая высота строки. Сохраним изменения с помощью кнопки

![](../.gitbook/assets/sokhranit%20%282%29.png)

![](../.gitbook/assets/45.png)

 После построения отчет примет вид.

![](../.gitbook/assets/46.png)

