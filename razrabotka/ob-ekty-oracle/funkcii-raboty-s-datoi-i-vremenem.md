# Функции работы с датой и временем

Доработать статью!

Арифметические операции — сложение и вычитание.

Функция SYSDATE

Это одна из самых часто употребляемых функций, она возвращает текущую дату и время по часам сервера. Пример:

```sql
SELECT SYSDATE FROM dual
SYSDATE 26.12.2007 16:24:43
```

Функция ADD\_MONTHS\(d, x\)

Возвращает дату, полученную в результате прибавления к дате d одного или нескольких месяцев. Количество месяцев задается параметров х, причем х может быть отрицательным — в этом случае указанное количество месяцев вычитается из заданной даты.

Пример:

```sql
SELECT SYSDATE d,
ADD_MONTHS(SYSDATE, 3) dl,
ADD_MONTHS(SYSDATE, -3) d2 FROM dual
```

D Dl D2

26.12.2007 16:24:43 26.03.2008 16:24:43 26.09.2007 16:24:43

Функция LASTDAY\(d\)

Возвращает последнее число месяца, указанного в дате d. Пример:

```sql
SELECT SYSDATE d,
LAST_DAY(SYSDATE) dl FROM dual
```

D                                      Dl

26.12.2007 16:24:43 31.12.2008 16:24:43

Данная функция очень удобна для определения количества дней в заданном месяце, например:

```sql
SELECT SYSDATE    d,
T0_CHAR(LAST_DAY(SYSDATE),   'DD')  dl FROM dual
```

D Dl

26.12.2007 16:24:43 31

Функция MONTHS\_BETWEEN\(dl, d2\)

Функция MONTH\_BETWEEN возвращает количество месяцев между двумя датами dl и с!2 с учетом знака как dl-d2, возвращаемое число является дробным.

```sql
SELECT  M0NTHS_BETWEEN('2.09.2006\ '2.05.2006')  dl,
M0NTHS_BETWEEN('12.09.2006', '2.05.2006') D2, 
M0NTHS_BETWEEN('2.05.2006', '12.09.2006') d3 FROM dual
```

D1

D2

D3

4

4,32258064516129

-4,32258064516129

Функция TRUNC\(d\[,mask\]\)

Производит усечение указанной даты в соответствии с маской. Если маска не указана, то усечение производится до даты \(время отбрасывается\).

Пример:

```sql
SELECT SYSDATE dl,
TRUNC(SYSDATE) d2 FROM dual
```

Dl                                      D2

26.09.2006 16:45:26       26.09.2006

Рассмотрим типовые примеры — усечение даты до часов, дней, месяца и года. Форматная маска по умолчанию равна «DD»

```sql
SELECT SYSDATE dl,
TRUNC(SYSDATE,    'HH24')   6.2,
TRUNC(SYSDATE,    'DD')       d3,
TRUNC(SYSDATE,    'MM')       d4,
TRUNC(SYSDATE,    'YYYY')   d5 FROM dual
```

~D1                              D2                              D3              D4              D5

26.09.2006 16:49:21    26.09.2006 16:00:00   26.09.2006 01.09.2006 01.01.2006

Функция ROUND\(d\[,mask\]\)

Функция ROUND аналогична TRUNC, но вместо усечения она производит округление. Форматная маска по умолчанию равна «DD». Пример:

```sql
SELECT SYSDATE dl,
ROUND(SYSDATE) d2,
ROUND(SYSDATE, 'НН24')   d3,
ROUND(SYSDATE, 'DD')   d4,
ROUND(SYSDATE, 'MM') d5 FROM dual
```

Dl D2 D3 D4 D5

26.09.2006 16:50:50   27.09.2006 26.09.2006 17:00:00   27.09.2006 01.10.2006

Форматные маски, допустимые для функций TRUNC и ROUND

Рассмотрим подробнее форматные маски и особенности их применения:

Маска

Назначение

СС

Первый день столетия

YEAR,    или    YYYY,

или YY, или Y

Первый день года

Q

Первый день квартала

MONTH,   или   MON,

или ММ

Первый день месяца

WW

Тот же день недели, что и первый день текущего года

W

Тот же день недели, что и первый день текущего месяца

DDD или DD

День

DAY, или DY, или D

Первый день недели

НН,   или   НН12,   или НН24

Час

Ml

Минута

Функция TO\_DATE\(str\[,mask \[,nls\_lang\]\]\)

Функция ТО\_DATE преобразует строку str в дату. Преобразование ведется по маске mask, если она указана. Если маска не указана, то берется маска по умолчанию. В случае указания маски можно указать еще один параметр — язык, используемый при форматировании названий месяцев и дней. В случае ошибки анализа строки str в соответствии с заданной ошибка «ORA-01830: шаблон формата даты завершается перед преобразованием всей строки ввода». Кроме того, нередко встречается ошибка «ORA-01821: формат даты не распознан» — она возникает при указании недопустимой форматной маски. Пример:

```sql
SELECT T0_DATE('12.09.2006') d FROM dual
```

D

12.09.2006

Функция TO\_CHAR\(d\[,mask\]\)

Преобразует дату d в символьную строку в соответствии с заданной маской. В случае указания недопустимой маски возникает исключительная ситуация «ORA-01821: формат даты не распознан».

Пример:

```sql
SELECT SYSDATE dl,
TO_CHAR(SYSDATE,   'DD.MM.YY HH24:MI')   d2 FROM dual
```

Dl D2

[http://denizzone.com/oracle\_t6r8part1.html](http://denizzone.com/oracle_t6r8part1.html)

Пример: 

Разделение одного поля типа дата при вводе на два поля дата и время.

создается поле, типа name\_DATETIME date; \( \_DATETIME - обязательная приставка к имени поля\) 

на вьюхе добавляем поля: 

,to\_char\( name\_DATETIME ,'dd.mm.yyyy'\) name\_date  
,to\_char\( name\_DATETIME ,'hh24:mi:ss'\) name\_time  

на тригере добавим вьюхи:

 v\_tp \_вьюха\_%rowtype;

...

v\_tp. name\_DATETIME :=to\_date\(nvl\(:new. name\_date ,sysdate\)\|\|' '\|\|:new. name\_time , 'dd.mm.yyyy hh24:mi:ss'\);

