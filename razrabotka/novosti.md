# Новости

  
========================================================================

14.04.2009

Множественное выделение записей в универсальном справочнике

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

В нижней части окна универсального справочника добавлена кнопка

с изображением пачки документов и хинтом "Множественное выделение строк"

Нажав эту кнопку, можно одновременно выделить несколько строк

справочника - для этого надо удерживать нажатой клавишу &lt;Ctrl&gt;

Множественное выделение строк справочника может быть использовано

при перемещении групп строк в текущий узел группировки или исключении

их из группировок вообще

========================================================================

13.02.2007

Старое, но мало кому известное свойство документа: SQL\_UNIV

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Свойство SQL\_UNIV ставится на секции документа и позволяет задавать

фильтр на справочник Univers в зависимости от введенных значений.

Это свойство \(как правило, типа Memo\) должно содержать PL/SQL код,

который будет выполняться всякий раз при выпадении справочника Univers

непосредственно из панели документа \(из поля шапки, грида или др.\)

Назначение этого механизма в том, чтобы устанавливать значения

контекстных переменных значениями полей документа, и использовать

эти переменные в тексте SQL-запроса справочника \(например, для фильтра\)

Пример:

::::::::::::::::::::

BEGIN

ENVUN4.SetEnvValue\('DOC12345\_DEST',:DTDEP\);

ENVUN4.SetEnvValue\('DOC12345\_EXPED',:CTDEP\);

END;

/\*

DTDEP=indoc\_m\_dtdep

CTDEP=indoc\_m\_ctdep

\*/

::::::::::::::::::::

В настройках выпадающих справочников дополнительный фильтр можно

задать вместе со значением GR1 после знака '\'

Пример:

::::::::::::::::::::

TIP=P

GR1=2171\STRIH1\_CODPRODUCER=SYS\_CONTEXT\('ENVUN4','DOC12345\_EXPED'\)

::::::::::::::::::::

Здесь предполагается, что поле STRIH1\_CODPRODUCER уже включено в состав

полей справочника путем изменения текста запроса для типа 'P'.

========================================================================

**29.01.2007**

[**Итоги по строке** в отчетах F1Pivot](file:///D:/UNA/UNA.md-130409-4.1.5.052/un4setup/reps_f1r_pivot.html#F1PivotSums)Символ '+' в конце имен некоторых полей приводит к формированию итогов по строке по этим полям.

========================================================================

11.01.2007

Новые свойства справочника Univers и его карточек

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

У справочника Univers добавлено новое свойство: MainAttr

По аналогии с MenuAttr, оно содержит имя \(одной!\) секции

настраиваемой карточки, которая должна открываться вместо

стандартной карточки \(по кнопке "A"\)

Пример:

MainAttr=ATTR\_PRC

У настраиваемой карточки добавлены новые свойства:

ShowModal, ShowFullScreen, ShowStd, StdCaption

ShowModal=true

Карточка всегда отображается в отдельном \(модальном\) окне

ShowFullScreen=true

Модальное окно карточки появляется в полноэкранном режиме

ShowStd=true

Настраиваемая карточка показывается на вкладке,

а на предыдущей вкладке доступна стандартная карточка

StdCaption=Cartela generala

При включенном свойстве ShowStd настраивает заголовок вкладки,

на которой отображается стандартная карточка.

Кроме этого, добавлена возможность создавать новые, дополнительные вкладки

для настраиваемой карточки. Для этого служат следующие свойства:

TabCount, Tab?Caption, Tab?DetailHeight

TabCount=3

Количество дополнительных вкладок \(не считая основных\)

Может принимать значения от 0 до 9.

Tab1Caption=Preturi

Заголовок дополнительной вкладки \(число в имени свойства - номер вкладки,

причем Tab0Caption задает заголовок основной вкладки настраиваемой карточки\).

Tab2DetailHeight=121

Включает Detail грид на дополнительной вкладке и задает его высоту

\(число в имени свойства - номер вкладки\).

========================================================================

26.12.2006

Рождественский подарок - две опции на карточку Univers

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Когда карточка появляется не под основным гридом Univers,

а в отдельном окне, то к этому окну применимы новые опции.

Свойства добавляются в секции, описывающей карточку:

секция Cartela для стандартной карточки или соответствующая

секция для настраиваемой карточки.

HideTopPanel

Скрывает верхнюю панель с полями COD, CODVECHI, DENUMIREA.

Пример:

HideTopPanel=true

FocusOnGrid

Устанавливает фокус ввода при открытии карточки на грид

\(это происходит также при включенной опции HideTopPanel\)

Пример:

FocusOnGrid=true

Кроме того, напоминаю о существовании свойства DetailHeight,

открывающего второй \(detail\) грид на настраиваемой карточке.

Пример:

DetailHeight=121

========================================================================

15.12.2006

По многочисленным заявкам - кнопка "SO" для ЛЮБОГО документа

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

На панели инструментов текущего документа добавлена кнопка с изображением

желтого выдвижного ящика. Горячая клавиша - F8.

Фишка включается по свойству в секции документа "SoldAllowGrids"

Значением свойства должно быть имя грида, в который нужно добавлять

новые строки из остатков. Так как в документе может быть несколько

гридов, имя рабочего грида необходимо указать.

Кроме того, можно указать имена нескольких гридов, разделяя их запятыми.

В этом случае для выбора конкретного грида из списка нужный грид

должен иметь фокус \(на него надо ткнуть мышкой :-\) Если не активен

ни один грид из списка, рабочим считается первый грид в списке.

Никаких &REZTABLE более не поддерживается!

Все остатки должны быть построены при помощи процедуры UN$SLD.MAKE

Текст запроса на готовые остатки настраиваем через "Edit Query",

используя VSLD, VSLD1..4 или прямо XSLD.

Скрипт на построение остатков вводим в том же окне на новой вкладке

"SQL Prepare". Поддерживаются все автоматически заполняемые параметры,

кроме специфических для старого окна остатков параметров типа :m\_dtdep.

Эти параметры надо переименовать в стандартные - :indoc\_m\_dtdep.

Поддерживаются старые свойства "UniquePosition", "UseDefCant", "GRB\_CANT",

"ListFields" и "RezultFields". Их можно указать на уровне узла Sold,

но можно и обойтись без оного, указав эти свойства в секции документа.

Для этого свойства должны иметь префикс "Sold": "SoldUniquePosition".

Имя поля в рабочем гриде, используемое для ввода количества, определяется

с трех попыток. Сначала проверяется свойство "GRB\_CANT" - в нем имя поля.

Затем среди колонок грида ищется первая, имеющая в настройках параметр

FieldCant \(значение параметра несущественно, может быть пустым\).

И, если эти два метода ничего не дали, полем для количества считается

поле "CANT" - чаще всего этого как раз бывает и достаточно.

========================================================================

07.11.2006

Настройка формы для ввода данных сканером штрихкодов

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Форма для ввода данных сканером штрихкодов вызывается из окна документа

нажатием клавиши F12 на клавиатуре или кликом по панели инструментов.

Для включения этой возможности нужно задать непустое значение свойства

XBarCodeQuery в настройках документа. Это свойство задает текст запроса,

который по значению параметра BARCODE приносит набор значений для вставки

в документ. Параметр BARCODE заполняется значением введенного штрих-кода.

Свойство XBarCodePrefix задает стартовый символ, с которого начинается

каждый штрих-код. Этот символ добавляется сканером к реальному коду

каждый раз при вводе в компьютер. Это свойство является необязательным.

Свойство XBarCodeAutoPost значением true задает режим работы формы,

при котором пользователь не вводит никаких дополнительных данных

\(например, количество штук\), кроме самого штрих-кода, поэтому после

добавления новой строки таблицы ввод завершается автоматически.

Настройка грида, содержащего вводимые данные, выполняется при помощи

команды "Edit Query" в контекстном меню грида. Для переноса данных

из поискового запроса в целевой соответствующие поля должны иметь

одинаковые имена в обоих запросах.

========================================================================

06.11.2006

Настройка печати на принтер этикеток

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Печатать на принтер этикеток \(или на другое нестандартное устройство\)

можно из окна отчетов, из документа или формы. Функция печати является

дополнительным свойством отчета или печатной формы типа FastReport.

Печатать можно на различные типы устройств: Zebra LP, DATEX или любое

устройство, работа с которым ведется на уровне виртуального устройства

\(например, COM1-COM8, LPT1-LPT4, PRN и т.п.\)

Данные для печати этикеток берутся из мастер-запроса отчета или формы.

В этом запросе используются поля Stick\_NAME, STRIH1\_CODPRODUCER, PRET,

и в некоторых случаях используется поле FormText.

Вот перечень свойств и их примерных значений, которые могут быть заданы

в Администраторе на уровне узла отчета или печатной формы, управляющих

процессом печати на нестандартное устройство:

PrintSpecialDevice=true

PrintSpecialDeviceIndex=1

PrintSpecialDeviceName=ZEBRA Label Printer 2824

PrintSpecialDeviceCopies=2

PrintSpecialDevicePort=COM2

Stick\_MAGAZ=Supermarket 'SUPER'

Stick\_ADRES=Chisinau blvd Stefan cel Mare 1

Stick\_TITLE=Bine ati venit!

При печати через форму обязательными являются первые два свойства,

а через отчет - только свойство PrintSpecialDeviceIndex.

При печати через отчет некоторые из этих свойств можно изменять

визуально прямо перед построением отчета \(первые 4 свойства\)

При печати через документ или форму визуально менять эти свойства нельзя.

Печать на устройство выполняется только при PrintSpecialDevice=true

или \(в случае отчета\) при установленной соответствующей галочке.

Свойство PrintSpecialDeviceIndex принимает значения 0, 1 или 2.

Это свойство является обязательным, при пустом значении этого свойства

печать на устройство не выполняется, и управляющая панель в окне отчетов

не видна. Значения 0 и 1 служат для печати на принтер Zebra LP 2824,

разница между ними только в использовании поля PRET из мастер-запроса:

значение 1 - стикеры с ценой \(ценники\), значение 0 - стикеры без цены.

Значение 2 - печать на принтер DATEX или на любое устройство на порту.

Свойство PrintSpecialDeviceName - необязательное, используется при работе

через печатную форму для указания имени устройства в тексте всплывающего

сообщения для подтверждения пользователем намерения печатать на устройство.

Свойство PrintSpecialDeviceCopies - необязательное \(по умолчанию "1"\),

задает количество копий каждой этикетки в запросе \(максимум "20"\)

Свойство PrintSpecialDevicePort - необязательное \(по умолчанию "COM1"\),

используется только при PrintSpecialDeviceIndex=2. При помощи этого

свойства можно указать, к какому порту \(виртуальном устройстве\) подключено

реальное физическое устройство, на котором нужно печатать этикетки.

В сочетании с использованием поля FormText в мастер-запросе это свойство

обеспечивает широкие возможности в настройке интерфейса с устройством.

Свойство Stick\_MAGAZ используется при PrintSpecialDeviceIndex=0 или 1

и задает название организации \(магазина\), которое выводится на этикетке.

Свойство Stick\_ADRES используется при PrintSpecialDeviceIndex=0 или 1

и задает адрес организации \(магазина\), который выводится на этикетке.

Свойство Stick\_TITLE используется при PrintSpecialDeviceIndex=2 в случае,

когда в мастер-запросе отсутствует поле FormText, для задания заголовка

этикетки. Формат этикетки в этом случае задается шаблоном, текст которого

"зашит" в программу и является неизменным.

В случае же, когда в мастер запросе присутствует поле FormText

\(обязательно при PrintSpecialDeviceIndex=2\), другие поля запроса

не используются, а значение поля FormText посылается прямо в порт.

Благодаря этой возможности можно печатать этикетки любого формата

и содержания, а также использовать устройства различный типов.

========================================================================

27.06.2006

Сокращенный метод задания дизайна в тексте SQL-запроса

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Упрощенно дизайн грида - это заголовки столбцов и их ширины.

Теперь эти свойства полей можно задать прямо в тексте запроса

при помощи свойств ".Captions" и ".Widths" в комментарии.

Пример:

::::::::::::::::::::

SELECT COD,CODVECHI,DENUMIREA FROM VMS\_UNIVERS

WHERE TIP='O' AND GR1='R'

/\*

.Captions=,"Табельный номер",Сотрудник

.Widths=0,10,40

\*/

::::::::::::::::::::

Задание ширины 0 для поля "COD" приведет к тому, что этого столбца

просто не будет в гриде, поэтому заголовок для него можно не задавать.

Поэтому же после знака "=" сразу идет запятая. Заголовки столбцов,

состоящие из нескольких слов, надо брать в кавычки \("Табельный номер"\)

Заголовки из одного слова заключать в кавычки можно, но не обязательно.

При наличии сохраненного дизайна он будет загружен, как обычно.

Но при отсутствии сохраненного дизайна столбцы будут настроены,

как описано выше.

========================================================================

30.05.2006

Новые методы работы с глобальными временными таблицами

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Замечено, что использование операторов CREATE TABLE во время работы

программы приводит ко многим негативным последствиям:

- Происходит неявный COMMIT, отмена изменений не выполняется

- Происходит кратковременная блокировка всего сервера

- При большом количестве пользователей сервер заметно "тормозит"

- Происходят непонятные ошибки, очевидно, по вине разработчиков

  Oracle - но нашим пользователям от этого не легче.

В большинстве случаев можно решить задачу без создания таблиц "на лету",

для этого таблица должна быть создана заранее, и имя ее должно быть

заранее известно. Это должна быть глобальная временная таблица, чтобы

пользователи в разных сессиях не мешали друг другу. Но создавать ее

перед каждым использованием больше не нужно.

Если каждый пакет будет использовать несколько таких постоянно

существующих таблиц, их количество возрастет настолько, что управлять

ими вручную будет очень сложно. Для облегчения этой задачи достаточно

соблюдать следующие несколько правил:

1. Имя каждой временной таблицы должно начинаться с префикса "TMP\_",

далее идет уникальная сигнатура, указывающая на пакет-владелец таблицы,

и затем идет произвольное окончание имени, указывающее на ее назначение.

2. Имя каждого представления \(VIEW\), построенного на базе такой таблицы,

должно начинаться с префикса "VTMP\_", далее - по тем же правилам.

3. Каждый пакет, использующий временные таблицы, должен содержать

процедуры InitObjects и DropObjects для создания и удаления объектов

\(временных таблиц, индексов, триггеров, представлений, счетчиков и т.п.\)

Эти процедуры должны вызываться без параметров, так как планируется

применять ко всем пакетам единый подход для создания и удаления объектов.

4. Для имен особо важных временных таблиц допускается префикс "X",

соответствующие им представления могут иметь префикс "V" \(для удобства\)

Новый метод построения таблицы остатков

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

В схеме UN4PUBLIC появился новый пакет UN$SLD. В нем имеются процедуры

InitObjects и DropObjects для создания и удаления своих объектов,

а также процедура MAKE и функция GET\_SOLDT. Процедура MAKE заполняет

таблицу XSLD значениями остатков, используя все параметры, как обычная

функция UN$SOLD.GET\_SOLDT, за исключением параметра sTableName, который

является ключевым значением вводимых данных, так как попадает в поле ID.

Получить значения остатков можно запросом SELECT \* FROM XSLD WHERE ID=:ID

Для удобства выборки имеются представления VSLD и VSLD1 .. VSLD4

Функция GET\_SOLDT вызывает процедуру MAKE и возвращает имя одного из

нескольких представлений: VSLD, VSLD1, VSLD2, VSLD3 или VSLD4,

в зависимости от значения параметра sTableName \(NULL, 1, 2, 3 или 4\).

При любых других значениях параметра sTableName будет выдана ошибка.

Функция GET\_SOLDT не несет никакой функциональности и добавлена только

для удобства модификации старых исходников: в текстах достаточно

изменить имя пакета с UN$SOLD на UN$SLD, а в случае нескольких таблиц

проставить значение второго параметра как значение от '1' до '4'.

По завершению транзакции таблица остатков \(XSLD\) ТЕРЯЕТ ВСЕ ЗНАЧЕНИЯ!

========================================================================

19.05.2006

Два механизма выдачи сообщений из триггеров

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Для использования этих возможностей нужен build 4.1.1.52

Иногда нужно выдать из триггера предупреждающее сообщение,

сохраняя при этом возможность ввода данных.

Теперь для этого есть два способа:

1. Процедура WARN

В новом скрипте на создание схемы UN4PUBLIC наряду с процедурами

SAY и MSG появилась процедура WARN. Работает она подобно MSG,

но запоминает последний переданный ей текст сообщения, и при

повторении текста процедура ничего не делает.

Таким образом, выдавая в триггере сообщение этой процедурой,

мы позволяем пользователю ввести данные, просто повторно нажав Enter.

2. Свойство ShowDBMSOutput

На вкладке Sagi Properties появилось новое свойство ShowDBMSOutput,

при установке которого при каждой DML-операции будет проверяться

буфер текстового вывода \(перед операцией он очищается, после операции -

проверяется\). При наличии текстовых сообщений пользователю будет

показано окно, содержащее текст этих сообщений.

Таким образом, выдавая в триггере несколько сообщений процедурой SAY,

мы не прерываем работу триггера, и все сообщения накапливаются и будут

показаны пользователю за один раз. Это удобно в случае множественных

проверок, когда процедура WARN не подходит \(она прерывает выполнение\).

========================================================================

11.05.2006

Отключение копирования фискального кода в TMS\_UNIVERS.CODVECHI

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Для использования этой возможности нужен build 4.1.1.51

В Администраторе в главной записи в разделе "Настройки"

в секции Cartela прописать свойство CopyCodFiscal=false

\[ZZZ\]

CopyCodFiscal=false

.type.CopyCodFiscal=Boolean

.listValue.CopyCodFiscal=true,false

========================================================================

03.05.2006

Использование подцветки строк в 201 документе

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Для использования этой возможности нужен build 4.1.1.49

1. Создайте VIEW на базе VMDB\_201D с полем BGCOLOR NUMBER\(10\)

2. На секции документа укажите имя этого VIEW в свойстве DetailTableName

3. На секции документа добавьте свойство DetailTableUseBgColor=true

4. На дизайне грида включите "Use BgColor" и "Save Grid Properties"

Форма начислений и удержаний на Oracle9i

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Для правильной работы новой формы нужен build 4.1.1.48

На секции формы добавьте свойство Oracle9i=true

========================================================================

21.04.2006

Настройка документа для ввода данных сканером штрих-кодов

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

1. Включить UseSmartEnter - правый &lt;Enter&gt; будет работать, как &lt;Tab&gt;,

   а в конце строки сохранять ее и вставлять следующую \(Insert\)

2. Поле со штрихкодом настроить как выпадающий справочник, включив опции

   "Using speed search", "Search text value" и "Search whole text"

3. Для связки с полем, содержащим код Univers, надо добавить свойство

   Origin=\[code\_field\_name\] \(например, для DTSC: Origin=DTSC\)

4. Чтобы после Insert выбиралось сразу это поле, добавить свойство

   StartField=1

5. Если справочник настроен как произвольный SQL-запрос, обязательно

   указать List Fields и Result Fields

   \(2 поля через запятую: поле кода Univers и поле штрих-кода\)

Первый раз надо нажать Insert, а дальше - только правый &lt;Enter&gt;

========================================================================

**12.09.2005**

[**Точка в счете** для предприятий ПМР](file:///D:/UNA/UNA.md-130409-4.1.5.052/un4setup/init.html#UseDotInCont)Эта настройка приводит к отображению счетов с точкой между второй и третьей цифрами.

**21.07.2005**

[**Экспорт** данных в BDE](file:///D:/UNA/UNA.md-130409-4.1.5.052/un4setup/sql_params.html#OUTBDE)Теперь в действиях \(Actions\) документов и форм можно экспортировать данные в таблицу BDE \(формат Paradox, dBase/FoxPro и даже ASCII - текстовый файл\).

**05.07.2005**

[Подмена файла **"startup.ini"**](file:///D:/UNA/UNA.md-130409-4.1.5.052/un4setup/init.html#STARTUP_INI)На самом деле эта "фишка" реализована достаточно давно, но о ней мало, кто слышал: файл **"un4.ini"**, помещенный в системный каталог WINDOWS, будет использован программой вместо файла **"startup.ini"**, размещенного в каталоге запуска программы

**29.06.2005**

[Параметр **SoldAutoRefresh**](file:///D:/UNA/UNA.md-130409-4.1.5.052/un4setup/docs.html#SOLD)Новая опция окна остатков \(SO\) - Автоматическое обновление данных верхней таблицы окна остатков при внесении изменений в нижнюю[Параметр **SoldLoadParams**](file:///D:/UNA/UNA.md-130409-4.1.5.052/un4setup/docs.html#5104)Новая опция документа 5104 \(ОС: Ввод в эксплуатацию\) - подгрузка дизайна списка

**29.04.2005**

[Параметр **SoldColumns**](file:///D:/UNA/UNA.md-130409-4.1.5.052/un4setup/docs.html#5104)Новая опция документа 5104 \(ОС: Ввод в эксплуатацию\) - дополнительные колонки в таблице остатков

**11.04.2005**

[Новая **CST3-вкладка** \(с тремя гридами\)](file:///D:/UNA/UNA.md-130409-4.1.5.052/un4setup/docs_xcst.html)В документе любого типа - достаточно одного свойства в секции документа

**08.04.2005**

[Параметр **GridDisableNumberSearch**](file:///D:/UNA/UNA.md-130409-4.1.5.052/un4setup/init.html#GridDisableNumberSearch)Новая опция программы - запрет числового поиска

**23.03.2005**

[Документ **CST3**](file:///D:/UNA/UNA.md-130409-4.1.5.052/un4setup/docs_xcst.html)Новый настраиваемый документ: CST3 \(с тремя гридами\)

========================================================================

16.02.2006

Настройка ограничения доступа на изменение универсального справочника

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Теперь можно заблокировать от изменений отдельные разделы справочника

и дать отдельным пользователям права на внесение изменений в отдельные

разделы, в том числе заблокированные.

Инструкция:

~~~~~~~~~~~

1. Выполнить апгрейд базы до версии 370

2. Заполнить таблицу TMS\_UNIVLOCK блокирующими записями вида:

   INSERT INTO TMS\_UNIVLOCK \(TIP,GR1,PERSON\) VALUES \('O','E','Vasea'\)

   Для каждого блокируемого раздела указать фамилию ответственного.

3. Отдельным пользователям внести в InitSQL разрешающие записи вида:

   INSERT INTO VUNIVUNLOCK \(TIP,GR1\) VALUES \('O','E'\)

Примечание:

~~~~~~~~~~~

- Если не указан GR1 - подразумевается любой GR1 при указанном типе.

- Если не указаны ни TIP, ни GR1 - подразумевается весь справочник.

========================================================================

12.01.2005

Настройка программы для работы с медленным каналом

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Такая настройка включает в себя следующие действия:

0. Ограничение записей un4sysdata в administrator настройкой св-ва

на уровне группы пользователей UserRecords, например UserRecords=1,2,3

1. Включение кеша дизайнов в ОЗУ

2. Включение файлового кеша дизайнов и настроек

3. Включение режима упакованных дизайнов и настроек

Для работы с новыми возможностями надо прописать свойство

NewDesignMethod=1

в файле startup.ini

Включение кеша дизайнов в ОЗУ

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Для включения кеша дизайнов в ОЗУ надо прописать свойство

GridPropCacheLimit=20

Значение этого параметра - максимальное количество узлов, одновременно

кешируемых в оперативной памяти. Под узлом здесь понимается документ,

отчет или справочник. Документы одного типа \(общий SysFID\) используют

один и тот же узел кеша.

Свойство GridPropCacheLimit может быть прописано в файле startup.ini,

в 'System Settings', на уровне группы или отдельного пользователя

\(перечислено в порядке возрастания приоритета\).

Включение файлового кеша дизайнов и настроек

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Для включения файлового кеша дизайнов и настроек надо прописать свойство

UseLocalCache=1

в файле startup.ini

Включение этого свойства приводит к сохранению настроек и дизайнов

в специальном файле \(в каталоге для временных файлов\), откуда они

могут быть в дальнейшем загружены \(вместо закачки с сервера\).

Для каждого пользователя создается отдельный файл, поэтому настройки

не пересекаются. Каждый дизайн и каждый раздел настроек сохраняется

со своей меткой времени \(timestamp\). Таймстамп содержит дату и время

создания или последней модификации блока данных и хранится на сервере

вместе с каждым дизайном или разделом настроек. При внесении изменений

в настройки или при новом сохранении дизайна таймстамп изменяется,

и при следующем обращении программы к кешу тот обнаруживает изменение

и инициирует новую закачку с сервера, помещая результат вместо старой

информации.

Включение режима упакованных дизайнов и настроек

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Для включения режима упакованных дизайнов и настроек нужно сделать

следующее: на стороне сервера запустить сервер упаковки \(и обеспечить

его автоматический запуск при старте системы\), а на стороне клиента

прописать свойство

UsePackedIni=1

в файле startup.ini

Сервер упаковки - это программа PackSrv.exe

Настройка сервера упаковки выполняется при помощи файла PackSrv.ini

в том же каталоге, где и файл PackSrv.exe - при отсутствии этого файла

достаточно один раз запустить сервер упаковки и установить соединение

с требуемым сервером Oracle, и файл будет создан автоматически.

Сервер упаковки использует для соединения c Oracle схему UN4PUBLIC

Примечание

~~~~~~~~~~

Свойства NewDesignMethod, UseLocalCache и UsePackedIni

должны быть прописаны в файле startup.ini, так как их значения

должны быть известны до загрузки настроек.

========================================================================

Новые настройки

в параметры предприятия добавлены

prm\_COD\_UNIV VARCHAR2\(10\)  := \'\';

prm\_IDNO VARCHAR2\(20\):=\'\';

TVA

Идеология:

1.

в каждой проводке где используется счет 5342 должен присутствовать в соответствуещем cont1 

код определяющий ставку НДС данной проводки, либо код 100 - "не выводить информацию 

данной проводки в отчет по НДС". 

2.

В случае отсутствия явно указанного cont1 отчет 

пытается определить ставку исходя из соотношения "сумма\_НДС"/"сумма\_базовая" если результат 

соответствует ставкам 5,8,20 % то данная проводка будет отрисована в отчете корректно.

3. 

Предусмотрена возможность явного указания "базовой\_суммы" в поле summa\_GAAP проводки с НДС

для случаев когда невозможно определить "базовую\_сумму" расчетным путем, например при

импорте НДС определяется не только исходя из стоимости товаров импортируемых, но и с учетом 

других составляющих, транспортные расходы, страховки, сопутствующе услуги. которые будут учтены

при расчете суммы НДС однако могут не присутствовать в учете сами по себе.

4.

При генерации проводок по НДС с помощью GFC\_UTIL cont1 счета 5342 будет определятья 

автоматически по принципам используемым в UN$FUNCTS.TVA.

Настройка:

1. настроийка для админа TMG:

 "Регистр покупок \(НДС\).txt"

 "Регистр продаж \(НДС\).txt"

2. templates:

 reg\_proc\_v2.vts

 reg\_vinz\_v2.vts

3. вьюшки на которых построены отчеты

 VMDB\_TVAREG\_PURCHASES2.vw

 VMDB\_TVAREG\_VINZ2.vw

4. ins\_cont1\_5342.sql - настройка счета 5342

INSERT INTO TMS\_PDC \( ATTR1, ATTR2, CONT, DENUMIREA, CONT1 \) VALUES \( 

53, 534, 5342, 'TVA 5%', 5\); 

INSERT INTO TMS\_PDC \( ATTR1, ATTR2, CONT, DENUMIREA, CONT1 \) VALUES \( 

53, 534, 5342, 'TVA 8%', 8\); 

INSERT INTO TMS\_PDC \( ATTR1, ATTR2, CONT, DENUMIREA, CONT1 \) VALUES \( 

53, 534, 5342, 'TVA 20%', 20\); 

INSERT INTO TMS\_PDC \( ATTR1, ATTR2, CONT, DENUMIREA, CONT1 \) VALUES \( 

53, 534, 5342, 'TVA 0%', 91\); 

INSERT INTO TMS\_PDC \( ATTR1, ATTR2, CONT, DENUMIREA, CONT1 \) VALUES \( 

53, 534, 5342, 'Fara TVA', 92\); 

INSERT INTO TMS\_PDC \( ATTR1, ATTR2, CONT, DENUMIREA, CONT1 \) VALUES \( 

53, 534, 5342, 'TVA la import', 93\); 

INSERT INTO TMS\_PDC \( ATTR1, ATTR2, CONT, DENUMIREA, CONT1 \) VALUES \( 

53, 534, 5342, 'TVA care nu se includ in registre procurari si vinzari', 100\); 

COMMIT;

5.

 GFC\_UTIL.SQL -- добавлен наворот по генерации дт1 и кт1 для НДС с 

  автоматическим определением нужного кода по базовой проводке \(зависит от UN$FUNCTS.SQL \)

 UN$FUNCTS.SQL -- добавлена функция фозвращающая cont1 для 5342 \(TVA\_CONT1\)

 ABM\_UTIL.SQL -- добавлены недостающие параметры в функцию SQLH \("код по НДС" ... \)

                нужна для корректной отрисовки header'a отчетов

/\*5. update\_cm\_migrating\_on\_cont1\_5342.sql -- наведение порядков в имеющихся проводках\*/

---------------------------------------------------------

в секцию UnivList\_P\_TVR надо вставить свойство AutoFilterTree=1

если есть UnivList\_P\_Marfuri - переименуй

\[ZZZ\]

AutoFilterTree=1

.type.AutoFilterTree=String

\[ZZZ\]

InsertUnderTree=true

.type.InsertUnderTree=Boolean

.listValue.InsertUnderTree=true,false

Настройка выполняется так:

1. В секции General свойство BG\_FILTER\_SECTION

- если оно непустое, то включается весь механизм - форма на старте или DefNrSet, кнопка SubSet и т. д. 

- значение свойства роли не играет

2. В секции группы или юзера свойство XDEF\_BGFILTER

- если оно непустое, то вместо формы на старте устанавливается фильтр по перечисленным ID

- если свойство == "\*" \(просто символ звездочки\), то устанавливается фильтр "Полная база данных"

3. В секции группы или юзера свойства LACObjectsSelectedOnly и LACSetupBlockObjects

- если у юзера нет прав на объект NRSET, то кнопка SubSet не видна

Пример настроенного пользователя \(vvv,vvv\) в файле User\_VVV.txt

XDEF\_BGFILTER=332,333

.type.XDEF\_BGFILTER=String

\[ZZZ\]

SpeedSearchQuery=SELECT cod,\(SELECT denumirea\_\_1 FROM vms\_univers u WHERE u.cod=t.cod \) denumirea\_\_1 FROM TMS\_MPT t WHERE

.type.SpeedSearchQuery=String

StartField=STRIH1\_CODPRODUCER

.type.StartField=String

продублировать узел

персональный SQL в UnivList на grupe

\[ZZZ\]

SagiEditQuery=true

.type.SagiEditQuery=Boolean

.listValue.SagiEditQuery=true,false

В System Settings добавить

\[CARTELA\]

.Parent=System settings

.Caption=CARTELA

.TypeNODE=CM

.BasedOn=CM

AdditionalColumns=false

.type.AdditionalColumns=Boolean

.ListValue.AdditionalColumns=true,false

\[ATTR\_PRC\]

.Parent=CARTELA

.Caption=ATTR\_PRC

.TypeNODE=CM

.BasedOn=CM

UseTimer=false

.type.UseTimer=Boolean

.listValue.UseTimer=true,false

SQL\_Init=

.type.SQL\_Init=String

Caption=Preturi

.type.Caption=String

\[ATTR\_SLD\]

.Parent=CARTELA

.Caption=ATTR\_SLD

.TypeNODE=CM

.BasedOn=CM

UseTimer=true

.type.UseTimer=Boolean

.ListValue.UseTimer=true,false

Caption=Solduri

.type.Caption=String

SQL\_Init=

.type.SQL\_Init=String

дизайны

св-во в карточке univlist

\[ZZZ\]

MenuAttr=ATTR\_PRC,ATTR\_SLD

.type.MenuAttr=String

VMS\_UNIV\_P15TVR\_PR

========================================================================

24.11.2004

Params JoinFields CONT,CONT1,SC

========================================================================

22.11.2004

Теперь в отчете UniversalStructure \(DLL ID=4201,Report ID=24\) можно

использовать свойства SQLBefore, SQLMaster и SQLDetail. Последние два

свойства заменяют собой общее свойство SQL для создания различных

входных запросов уровня master и detail. SQLBefore содержит выражение,

выполняемое до построения отчета \(до вычисления SQLMaster и SQLDetail\).

В выражениях SQLMaster и SQLDetail можно использовать выходной параметр

:RESULT, который возвращает значение имени таблицы или текста запроса.

Во всех SQL-выражениях можно использовать входные параметры и именами

вида :FILTER\_xxx, где xxx - имя поля RSE. Значение такого параметра -

выбранный пользователем входной фильтр по указанному полю, его удобно

использовать при построении таблиц или запросов уровня master и detail.

Во всех SQL-выражениях можно использовать входные параметры и именами

вида :USE\_xxx, где xxx - имя поля RSE. Значение такого параметра -

"1" или "0", причем "1" означает, что поле включено в отчет.

========================================================================

19.11.2004

Теперь в отчетах, использующих технологию RSE, можно легко строить поля

типа ref для получения доступа к структуре группировок \(TMS\_SYSGRP\)

и маски продукции \(TMS\_STRGRPUNIV\_ARR\) - см. файл RSE.txt

========================================================================

20.10.2004

Теперь в окне остатков можно использовать "кол-во по умолчанию" - некую

порцию, квант, который автоматически добавляется в нижнюю таблицу по нажатию

клавиши "+" в верхнем гриде. Курсор при этом остается в верхнем гриде.

Добавление кол-ва по уже добавленной позиции не создает новую строку,

а увеличивает количество в имеющейся строке. Клавиша "-" удаляет порцию

количества в нижнем гриде, а при уменьшении кол-ва до нуля удаляет строку.

Все эти возможности \(кроме замены INSERT на UPDATE, которая работает всегда\)

включаются параметром UseDefCant=true в секции объекта Sold. При включении

этого параметра в верхней части окна остатков появляется панель, в которой

можно ввести "количество по умолчанию". При нулевом значении "количества

по умолчанию" окно ведет себя традиционным образом, за исключением того,

что не дублирует строки с одинаковой аналитикой и правильно отслеживает

максимальное количество \(сообщение "Введенное количество превышает остаток"

выскакивает теперь только тогда, когда это соответствует действительности\)

Ввод "количества по умолчанию" может выполняться как вручную, так и путем

ввода в выпадающем справочнике типа CantInTara

========================================================================

19.10.2004

Добавлен новый тип справочника - CantInTara. Этот справочник позволяет

вводить количество единиц какой-то упаковки и получать реальное количество

согласно значениям таблицы TMS\_UMS \(VMS\_UMS\). Работает это так: перед

выпадением справочника вызывается метод UN4UMS.FillTable из схемы UN4PUBLIC,

который очищает таблицу UN4PUBLIC.XUMS и заполняет ее строками из VMS\_UMS,

относящимися к указанному коду Univers. Выпадающий справочник показывает

именно эту таблицу UN4PUBLIC.XUMS, позволяя менять в ней только поле CANT.

При выборе нужной строки введенное количество в этой строке умножается

на значение поля CANT\_UM \(поле CANT из VMS\_UMS\) и результат вставляется

в поле, из которого был вызван справочник.

Пример настройки справочника:

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

:::::::::::::::

LISTTYPE=CantInTara

FIELD\_COD=DTSC

:::::::::::::::

Примечание:

~~~~~~~~~~~

Параметр FIELD\_COD должен содержать имя поля, в котором находится код Univers,

количество которого требуется вводить при помощи описанного справочника.

========================================================================

15.10.2004

Теперь в третьем системном столбце шаблона для FormulaOne

можно вставить формулу, управляющую использованием этой строки.

Это работает только для строк Detail1 и Detail2. Синтаксис такой:

-----

\(a\) Просто имя поля \(проверка на совпадение с 1\)

UseWhen\(ISTOTAL\) - используется при значении поля ISTOTAL = 1

-----

\(b\) Имя поля и целочисленное значение - проверка на совпадение

UseWhen\(ISTOTAL, 0\) - используется при значении поля ISTOTAL = 0

UseWhen\(ISTOTAL = 0\) - используется при значении поля ISTOTAL = 0

UseWhen\(ISTOTAL == 0\) - используется при значении поля ISTOTAL = 0

-----

\(c\) Имя поля и целочисленное значение - проверка на несовпадение

UseWhen\(ISTOTAL &lt;&gt; 0\) - используется при значении поля ISTOTAL &lt;&gt; 0

UseWhen\(ISTOTAL != 0\) - используется при значении поля ISTOTAL &lt;&gt; 0

UseWhen\(ISTOTAL ! 0\) - используется при значении поля ISTOTAL &lt;&gt; 0

-----

Естественно, имя поля "ISTOTAL" и значение "0" даны только как пример.

Регистр и пробелы роли не играют и используются только для читабельности.

========================================================================

12.10.2004

Доработана универсальная настраиваемая форма - теперь она может показывать

данные в двух таблицах, связанных отношением Master-Detail, и может

не показывать данных вовсе - в этом случае она выглядит как бледно-желтая

панель.

Главные \(идентификационные\) параметры формы:

DLL ID=8101

DLL FormName=FSal1p01

Дополнительные параметры \(приведены значения по умолчанию\):

FormNoGrid=false

FormUseDetail=false

MasterSize=201

Параметр FormNoGrid, установленный в true, означает работу без таблиц.

Параметр FormUseDetail, установленный в true, означает работу с двумя

таблицами, причем основная таблица становится Master-таблицей.

Значение параметра MasterSize определяет визуальный размер Master-таблицы.

Положительное значение параметра MasterSize означает высоту Master-таблицы,

при этом Detail-таблица будет расположена в нижней части формы.

Отрицательное значение параметра MasterSize означает ширину Master-таблицы,

при этом Detail-таблица будет расположена в правой части формы.

Параметры SQL-запросов могут быть сохранены как в свойствах Administrator,

так и вместе с дизайном столбцов в таблице XGRIDPROP. В первом случае

имена параметров, определяющих SQL-свойства Detail-таблицы, образуются

из имен параметров Master-таблицы добавлением первого символа 'X':

SQL=

SQL\_Insert=

SQL\_Delete=

SQL\_Update=

SQL\_Refresh=

SagiQuery=

SagiTable=

SagiWhere=

Sagi\_OrderBy=

XSQL=

XSQL\_Insert=

XSQL\_Delete=

XSQL\_Update=

XSQL\_Refresh=

XSagiQuery=

XSagiTable=

XSagiWhere=

XSagi\_OrderBy=

Типы всех параметров, кроме SagiTable и XSagiTable, могут быть как Memo,

так и String. Типы параметров SagiTable и XSagiTable должны быть String.

При наличии настроек SQL-запросов одновременно в Administrator'е и в

дизайне гридов приоритет имеют настройки, сохраненные в дизайне гридов.

========================================================================

05.10.2004

Теперь при построении печатных форм, выполнении функций документа или

формы, открытии произвольных справочников заполнение параметров запроса

выполняется одним общим методом. Значение и тип параметра определяется

именем параметра \(см. ниже - замечание от 26.06.2004\)

Параметры запроса, для которых не удается найти значение автоматически,

предлагаются пользователю для заполнения вручную - теперь в одном общем

окне. Для удобства пользователя можно задать тексты подписей слева от

каждого поля ввода \(можно задать несколько подписей для разных языков\).

Для контроля вводимых значений можно задать тип данных каждого параметра

или вообще заменить ручной ввод выбором из списка.

Дополнительная информация о параметрах задается в тексте SQL-запроса

в блоке комментария, каждое значение на отдельньй строке в INI-формате.

Пример \(его можно вставить как свойство SQL1 и проверить в действии\):

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

:::::::::::::::

begin

raise\_application\_error\(-20000,'Param values:

SimpleString: '''\|\|:SimpleString\|\|'''

   AnyNumber: '''\|\|:AnyNumber\|\|'''

     AnyDate: '''\|\|:AnyDate\|\|'''

     Univers: '''\|\|:Univers\|\|'''

        SysS: '''\|\|:SysS\|\|'''

'\);

end;

/\*

Captions:

.text.SimpleString=Простая строка

.text.AnyNumber=Любое число

.text.AnyDate=Любая дата

.text.Univers=Унив. справ.

.text.SysS=Сист. справ.

English captions:

.text.E.SimpleString=Simple string

.text.E.AnyNumber=Any number

.text.E.AnyDate=Any date

.text.E.Univers=Universal list

.text.E.SysS=System list

Types:

.type.AnyNumber=Number

.type.AnyDate=Date

.type.Univers=List,U,O,E

.type.SysS=List,S,F,2

\*/

:::::::::::::::

Примечания к примеру:

~~~~~~~~~~~~~~~~~~~~~

Строки "Captions:", "English captions:" и "Types:" не являются частью

описания и даны просто для удобства чтения \(программа их игнорирует\).

Для задания языка надписи используются буквы "E", "M" и "R".

Значение параметра .type.\* можно задавать в любом регистре, без разницы

\(date, Date и DATE дают одинаковый результат, и то же о Number или List\).

========================================================================

29.06.2004

Теперь в печатных формах документов и форм можно использовать параметр

SQLAllInOne для задания текстов запросов SQLHeader, SQLMaster и SQLDetail

Пример \(три параметра легко можно заменить одним\):

:::::::::::::::

SQLHeader=SELECT :NRDOC AS NRDOC FROM DUAL

SQLMaster=SELECT \* FROM VMDB\_DOCS WHERE COD=:NRDOC

SQLDetail=SELECT \* FROM VMDB\_CMR WHERE NRDOC=:NRDOC

:::::::::::::::

SQLAllInOne=

begin

:SQLHeader:='SELECT :NRDOC AS NRDOC FROM DUAL';

:SQLMaster:='SELECT \* FROM VMDB\_DOCS WHERE COD=:NRDOC';

:SQLDetail:='SELECT \* FROM VMDB\_CMR WHERE NRDOC=:NRDOC';

end;

:::::::::::::::

Неиспользуемые запросы \(например, SQLDetail часто не используется\)

можно не инициализировать \(то есть вообще не вводить как параметр\)

Основное преимущество такого подхода - возможность использования

глобальных временных таблиц и локальных переменных для исключения

дублирования вычислений в разных запросах.

А ТАКЖЕ:

~~~~~~~~

В текстах запросов теперь можно использовать параметры :DATEBEGIN

и :DATEFINAL \(см. ниже\)

Пример:

:::::::::::::::

SQLHeader=SELECT :DATEBEGIN AS DATEBEGIN, :DATEFINAL AS DATEFINAL FROM DUAL

SQLMaster=SELECT \* FROM VMDB\_DOCS WHERE DATAMANUAL BETWEEN :DATEBEGIN AND :DATEFINAL

:::::::::::::::

А ТАКЖЕ:

~~~~~~~~

В текстах запросов теперь можно использовать параметры, совпадающие

по имени с полями мастер-запроса \(если таковой имеется\). Для SQLDetail

мастер-запросом считается SQLMaster, а для SQLMaster мастер-запросом

считается SQLHeader. Поля SQLHeader доступны как параметры в SQLDetail

только в том случае, если SQLMaster не содержит полей с такими же именами.

Пример:

:::::::::::::::

SQLHeader=SELECT TRUNC\(:DATEBEGIN,'M'\) AS DATAS, LAST\_DAY\(:DATEFINAL\) AS DATAE FROM DUAL

SQLMaster=SELECT \* FROM VMDB\_DOCS WHERE DATAMANUAL BETWEEN :DATAS AND :DATAE

:::::::::::::::

Примечание: если в последнем примере поля назвать не DATAS и DATAE,

а DATEBEGIN и DATEFINAL, то в SQLMaster параметры все равно будут заполнены

не по общим правилам для :DATEBEGIN и :DATEFINAL, а из полей SQLHeader.

То есть значение параметра вначале ищется среди полей мастер-запроса.

========================================================================

28.06.2004

Теперь список Actions формы сортируется на экране по значению параметра ID,

а при отсутствии этого параметра его значение принимается равным нулю.

Actions с одинаковым ID сортируются по Caption \(по алфавиту\).

========================================================================

28.06.2004

Появилась возможность настраивать параметры выпадающего справочника

на полях типа SagiEdit по той же технологии, что и справочники гридов.

Для этого реализована возможность визуального редактирования этих

параметров, сохранения их в базе данных Oracle, загрузки и удаления.

Для визуального редактирования параметров выпадающего справочника

нужно кликнуть мышкой по кнопке справа, удерживая нажатыми клавиши

&lt;Ctrl&gt; и &lt;Alt&gt;, либо \(как для гридов\) нажать клавиши &lt;Alt&gt;+&lt;D&gt;.

Загрузить, сохранить и удалить параметры можно при помощи одноименных

кнопок в правом нижнем углу окна редактирования параметров справочника.

========================================================================

28.06.2004

Для использования настройки выпадающего справочника в дизайне документа,

созданного на базе 201, надо в Администраторе добавить свойство UsePickList

типа Boolean и присвоить ему значение true:

UsePickList=true

========================================================================

27.06.2004

Появилась возможность настраивать в дизайне грида параметры выпадающего

справочника как произвольного SQL-запроса с использованием параметров.

Параметры справочника сохраняются в текстовом поле в INI-формате,

но окно дизайна грида позволяет редактировать их визуально \(более наглядно\).

Ключевой параметр - TIP, значение которого определяет тип справочника.

Допустимые значения: U, S, P, I, i, M, Q.

Остальные параметры зависят от типа справочника:

Тип U \(справочник Univers\):

~~~~~~~~~~~~~~~~~~~~~~~~~~~

FIELD\_COD - поле, в котором сохраняется код Univers \(поле COD\)

FIELD\_CONT - счет или поле, в котором хранится счет

U\_FILTER\_LEVEL - уровень аналитики \(0: Sc, 1: Dep, 2:Sc1\)

U\_FILTER\_TIP - фильтр по полю TIP

U\_FILTER\_GR1 - фильтр по полю GR1

При указании FIELD\_CONT фильтр определяется из плана счетов с учетом

U\_FILTER\_LEVEL, а U\_FILTER\_TIP и U\_FILTER\_GR1 не используются.

При отсутствии параметра FIELD\_CONT фильтр определяется параметрами

U\_FILTER\_TIP и U\_FILTER\_GR1, а параметр U\_FILTER\_LEVEL не используется.

Примеры:

::::::::::::::::::::

TIP=U

FIELD\_COD=DTSC

FIELD\_CONT=DT

U\_FILTER\_LEVEL=0

::::::::::::::::::::

TIP=U

FIELD\_COD=CTDEP

FIELD\_CONT=5311

U\_FILTER\_LEVEL=1

::::::::::::::::::::

TIP=U

FIELD\_COD=SC\_PROD

U\_FILTER\_TIP=P

U\_FILTER\_GR1=2111

::::::::::::::::::::

Тип S \(справочник SysS\):

~~~~~~~~~~~~~~~~~~~~~~~~

FIELD\_COD - поле, в котором сохраняется код SysS \(обычно поле COD1\)

U\_FILTER\_TIP - фильтр по полю TIP

U\_FILTER\_GR1 - фильтр по полю COD

U\_SEL\_FIELD - ключевое поле \(по умолчанию COD1\)

Например, для выбора валюты U\_SEL\_FIELD должно иметь значение UM

Примеры:

::::::::::::::::::::

TIP=S

FIELD\_COD=CATEGOR

U\_FILTER\_TIP=R

U\_FILTER\_GR1=501

::::::::::::::::::::

TIP=S

FIELD\_COD=VALUTA

U\_FILTER\_TIP=S

U\_FILTER\_GR1=3

U\_SEL\_FIELD=UM

::::::::::::::::::::

Тип P \(справочник PDC\):

~~~~~~~~~~~~~~~~~~~~~~~

FIELD\_CONT - поле, в котором сохраняется счет

U\_FILTER\_CONTS - фильтр по счетам

Пример:

::::::::::::::::::::

TIP=P

FIELD\_CONT=CT

U\_FILTER\_CONTS=21 !217

::::::::::::::::::::

Типы I и i \(справочник UM\):

~~~~~~~~~~~~~~~~~~~~~~~~~~~

FIELD\_COD - поле, в котором сохраняется код единицы измерения

Выбор производится из запроса "SELECT ID\_UM,SHORT\_NAME,NAME FROM TMS\_UM"

Тип I означает визуальный выбор полного имени единицы измерения,

тип i означает визуальный выбор краткого имени единицы измерения.

Пример:

::::::::::::::::::::

TIP=I

FIELD\_COD=UM

::::::::::::::::::::

Тип M \(справочник по маске\):

~~~~~~~~~~~~~~~~~~~~~~~~~~~~

FIELD\_MASK -

FIELD\_COD -

U\_FILTER\_LEVEL -

Пример:

::::::::::::::::::::

TIP=M

FIELD\_MASK=

FIELD\_COD=

U\_FILTER\_LEVEL=

::::::::::::::::::::

Справочник по маске пока не документрован, так как маски не стандартизованы

Тип Q \(произвольный запрос\):

~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Текст запроса задается либо одной строкой как значение параметра SQL,

либо в несколько строк группой параметров SQL1, SQL2, SQL3 и т.д.

LISTFIELDS - список полей запроса, подлежащих копированию значений

RESULTFIELDS - список полей грида, в которые производится копирование

CAPTIONS - список заголовков столбцов

WIDTHS - список ширин столбцов

Примеры задания текста запроса:

::::::::::::::::::::

SQL=SELECT ID\_CONTRACT,CONTRACTNAME FROM VMS\_CONTRACT

::::::::::::::::::::

SQL1=SELECT ID\_CONTRACT,CONTRACTNAME FROM VMS\_CONTRACT

SQL2=WHERE TYPE=2 AND VALUTA&lt;&gt;'LEI'

::::::::::::::::::::

Как правило, дизайн выпадающего справочника сводится к заданию заголовков

и ширин столбцов - используя параметры CAPTIONS и WIDTHS, можно избежать

сохранения дизайна справочника и связанных с этим накладных расходов.

Для визуального сокрытия необходимого столбца можно задать ему ширину 0.

Пример задания дизайна справочника:

::::::::::::::::::::

CAPTIONS=,Контракт

WIDTHS=0,20

::::::::::::::::::::

Списки LISTFIELDS и RESULTFIELDS должны иметь ОДИНАКОВОЕ количество полей.

Списки CAPTIONS и WIDTHS могут иметь произвольное количество значений,

недостающие значения будут заполнены значениями по умолчанию.

Списки LISTFIELDS и RESULTFIELDS можно не указывать - тогда копирование

значений будет выполняться только для тех полей, которые имеют одинаковые

имена в справочнике и в гриде. Это достигается указанием алиасов полей

в тексте запроса справочника. Для указания алиаса поля, соответствующего

объектному полю грида \(имя объектного поля содержит точку\), надо заменить

точку на символ подчеркивания.

Пример упрощения: первый список параметров вполне может быть заменен вторым

::::::::::::::::::::

TIP=Q

SQL=SELECT \* FROM VMS\_PRODUCT

LISTFIELDS=ID\_PRODUCT,PRODUCT\_NAME

RESULTFIELDS=CONTA.SC,CLCCONTA\_SCT

::::::::::::::::::::

TIP=Q

SQL=SELECT ID\_PRODUCT CONTA\_SC,PRODUCT\_NAME CLCCONTA\_SCT FROM VMS\_PRODUCT

::::::::::::::::::::

При этом значение поля ID\_PRODUCT \(с алиасом CONTA\_SC\) будет скопировано

в объектное поле CONTA.SC

В тексте запроса справочника можно использовать параметры, имена которых

должны удовлетворять тем же правилам, что и имена параметров в Actions

документов и форм \(см. ниже\).

Пример:

::::::::::::::::::::

TIP=Q

SQL=SELECT ID\_PRODUCT,PRODUCT\_NAME FROM VMS\_CONTRACT WHERE DOCID=:NRDOC

::::::::::::::::::::

========================================================================

26.06.2004

В текстах запросов Actions документов и форм \(SQL1, SQL2 и т. д.\)

параметры заполняются значениями на основании их \(параметров\) имен.

В запросах можно использовать следующие параметры:

:RESULT - параметр не заполняется и не запрашивается у пользователя

:NRDOC - номер выбранного документа

:DATADOC - дата выбранного документа

:DATAMANUAL - дата выбранного документа

:DATEBEGIN - дата начала выбранного периода

:DATEFINAL - дата конца выбранного периода

Выбранный период определяется в верхней части окна отчетов.

При отсутствии окна отчетов выбранный период определяется

из настроек Администратора \(секция General\)

Значение параметра, имя которого осталось нераспознанным, запрашивается

у пользователя непосредственно перед выполнением запроса.

А ТАКЖЕ:

~~~~~~~~

При помощи сложных и длинных имен параметров можно получать доступ

к любым настройкам программы и к любым полям любых открытых таблиц

и запросов, но для этого важно учесть следующее замечание:

Если имя параметра превышает 20 символов или содержит недопустимые

символы, нужно использовать подстановку: в текст запроса ввести

короткое простое имя параметра, расшифровку которого в длинное

и сложное имя дать в блоке комментария на отдельной строке.

Пример:

::::::::::::::::::::

UPDATE VMDB\_CMI SET CANT=NULL WHERE NRDOC=:NRDOC AND CTSC=:UVOLEN

/\*

UVOLEN=\SYS\SLR\cod\_uvolen

\*/

::::::::::::::::::::

В приведенном примере параметр UVOLEN заполняется значением поля cod\_uvolen

из секции SLR раздела "Настройки" главной записи Администратора.

Несколько параметров можно расшифровать в одном блоке комментария,

но на разных строках.

Блок комментария игнорируется при выполнении запроса, но обрабатывается

как INI-данные при заполнении значений параметров для расшифровки имен.

Такое расшифрованное имя параметра, дающее ключ к нахождению значения

параметра, можно назвать формулой значения. Таким образом, допускается

использовать следующие формулы:

1. Доступ к данным Администратора

Формула должна начинаться с символа "\" и состоять из кода ветви,

секции и имени параметра, разделенных символом "\". Код ветви

может иметь следующие значения:

SYS - ветвь "Настройки"

DOCS - ветвь "Документы"

REPS - ветвь "Отчеты"

FORMS - ветвь "Настройки" \(то же, что и SYS, но только для параметров форм\)

Код ветви может отсутствовать \(вместе со своим разделителем "\"\) - в этом

случае подразумевается код ветви SYS.

Примеры:

::::::::::::::::::::

/\*

CTCONT=\REPS\AGRO02\CTCont - параметр CTCont отчета из секции AGRO02

CONTLEN=\General\LengthCont - подразумевается \SYS\General\LengthCont

\*/

::::::::::::::::::::

2. Доступ к полям текущего документа

Формула должна начинаться с символов "indoc\_", остальная часть формулы

обрабатывается документом.

Примеры:

::::::::::::::::::::

/\*

STRSC=indoc\_M\_CTSRTRSC - поле CTSRTRSC шапки документа

DTDEP=indoc\_D\_DTDEP - поле DTDEP таблицы документа

\*/

::::::::::::::::::::

3. Доступ к полям текущей \(последней открытой\) формы

Формула должна начинаться с символов "inform\_", остальная часть формулы

обрабатывается формой. В остальном правила аналогичны предыдущему пункту.

4. Доступ к любому полю любой открытой в программе таблицы

Формула должна начинаться с символов "field\_", после чего указывается

имя экземпляра объекта DataModule или Form, затем снова символ "\_",

и затем либо имя компонента типа Field, либо имя компонента типа DataSet

c именем поля за ним, отделенным символом "\_"

Для облегчения получения формулы в окне дизайна грида на вкладке

"Другие свойства поля" под надписью "Имя параметра для доступа извне",

приводится значение этой формулы для выбранного поля

Примеры:

::::::::::::::::::::

/\*

ID\_0M=field\_dmFMAgrA\_sq3\_03ProductID\_0M

ID\_1D=field\_dmFMAgrA\_sq3\_20ProcessID\_1D

\*/

::::::::::::::::::::

/\*

ID\_0M=field\_dmFMAgrA\_sq3\_03Product\_ID\_0M

ID\_1D=field\_dmFMAgrA\_sq3\_20Process\_ID\_1D

\*/

::::::::::::::::::::

Приведенные примеры получают доступ к полям ID\_0M и ID\_1D компонентов,

расположенных на DataModule dmFMAgrA, двумя разными способами - через

имя компонента типа Field и через имя компонента типа DataSet и имя поля.

А ТАКЖЕ:

~~~~~~~~

В текстах запросов можно ссылаться на таблицы BDE - в Oracle

создаются глобальные временные таблицы, аналогичные по структуре

и содержанию ссылаемым таблицам BDE, и имена этих временных таблиц

вставляются в текст запроса взамен текста ссылок.

Для этого таблица BDE должна существовать и находиться в каталоге,

прописанном в свойстве PATH какого-то из алиасов BDE. Как правило,

для этого создается отдельный алиас, но можно использовать и общий

алиас \(например, 1m или 1mPriv\).

Синтаксис такой ссылки допускает две формы - без кавычек и с кавычками.

Ссылки без кавычек используются в компилируемых запросах, а ссылки

с кавычками используются в запросах, выполняемых при помощи оператора

EXECUTE IMMEDIATE.

&BDE\#&lt;алиас&gt;\#&lt;таблица&gt; - ссылка без кавычек

&BDEQ\#&lt;алиас&gt;\#&lt;таблица&gt; - ссылка с кавычками

Для файлов, имеющих расширение, отличное от "DB" \(например, "DBF"\),

расширение нужно указывать явно:

&BDE\#&lt;алиас&gt;\#&lt;таблица&gt;\#&lt;расширение&gt; - ссылка без кавычек

&BDEQ\#&lt;алиас&gt;\#&lt;таблица&gt;\#&lt;расширение&gt; - ссылка с кавычками

Пояснение: расширением \(от англ. extension\) называется часть имени файла,

расположенная в самом конце и отделенная от остальной части символом точки.

Расширение косвенно указывает на формат представления данных в файле,

для каждого расширения система может хранить свои настройки по обработке.

Примеры \(таблицы CURS.DBF и 1MS\_UNIVERS.DB\):

::::::::::::::::::::

INSERT INTO VMDB\_CMI \(NRDOC,DT,CT,CTDEP,SUMA\)

SELECT :NRDOC,2421,5211,CLIENTID,SUMA FROM &BDE\#FINC\#CURS\#DBF

::::::::::::::::::::

BEGIN

EXECUTE IMMEDIATE

'CREATE TABLE OLD\_UNIVERS AS SELECT \* FROM '\|\|&BDEQ\#1M\#1MS\_UNIVERS;

END;

::::::::::::::::::::

========================================================================

13.05.2004

Блокирование изменений по счетам

таблица XLOCKCONTS, vXLOCKCONTS

триггер на CM  XTRGTMDB\_CM\_LOCKCONT

две формы типа 

\[fLockConts\]

.Form=

.BasedOn=FormL8000Lregcurs

.Parent=Forms group:8000:0

.Caption=LockConts

Caption=Lock conts

Active=true

DLL ID=8101

DLL FormName=FSal1p01

для формы определяется EditQuery 

одна форма для administratora - полное редактирование XLOCKCONTS

вторая форма для пользователя - только UPDATE на vXLOCKCONTS\(ChangeMinData,ChangeMaxData\)

блокирование делается триггер-м на CM  XTRGTMDB\_CM\_LOCKCONT

========================================================================

12.05.2004

ЗАЩИТА MAC-адресами

Св-ва в секции \[General\]

\[ZZZ\]

SecurityMode=0

.type.SecurityMode=Int

.listValue.SecurityMode=0,1

.listTextValue.SecurityMode=Отключён,"network card MAC-adress"

.Hint.SecurityMode=Контроль доступа

Св-ва в секции \[-USER-\]

\[ZZZ\]

CardID=00:02:44:52:6F:B3,00:E0:4C:80:05:41

.type.CardID=String

.Hint.CardID=Номер карточки/сетевой карты

\[ZZZ\]

SecurityMacServers=00:02:44:52:6F:B3,00:E0:4C:80:05:41

.type.SecurityMacServers=String

.Hint.SecurityMacServers=Список серверов, с которых разрещён вход любым user-m

чтобы узнать mac-адрес компьютера выполнить скрипт GetMAC.hta

 packages:

UN$USERPARAMS.PKS

UNP\_INI.pks

UN$G$UTIL.pks

UNP1.PKS

