# Свойства сводной таблицы F1Reports

**Требования и ограничения:**

Механизм построения сводной таблицы на базе отчетов, построенных по технологии F1Reports, состоит из двух этапов:

* Преобразование набора данных

Для правильной работы этого этапа нужен `ORACLE` пакет `UN$G_PIVOT` версии 1.01

* Преобразование шаблона отчета

Для работы этого этапа не требуется никакой предварительной подготовки, требуется обычный шаблон исходного отчета - каждый раз при построении сводной таблицы создается временный шаблон, являющийся результатом преобразования исходного шаблона. Этот временный шаблон автоматически удаляется при закрытии окна просмотра отчета.

Master/Detail:

Для построения сводной таблицы отчет должен содержать Master-запрос и **НЕ** содержать Detail-запрос.

Количество столбцов:

При построении сводной таблицы в отчете появляется несколько новых столбцов, количество которых заранее неизвестно и определяется только входными данными и параметрами настройки. Тем не менее существует техническое ограничение на количество столбцов в электронной таблице FormulaOne \(255\), а также есть разумное ограничение - при количестве столбцов, большем 100, пользователю трудно охватить вниманием такой большой объем информации. Поэтому на первом этапе при количестве добавляемых столбцов больше 200 процесс прерывается с сообщением:"Too many fields in the pivot table!".

**Параметры настройки:**

Настройка режима построения сводной таблицы заключается в создании набора параметров в секции отчета. Эти параметры приведены в следующей таблице:

| **Имя свойства** | **Тип** | **Описание** | **Значение для примера** |
| :--- | :---: | :--- | :--- |
| F1Pivot | Boolean | Включение режима сводной таблицы. Этот параметр определяет, будет ли строиться сводная таблица. Он позволяет временно выключить уже настроенную конфигурацию для построения отчета в исходном виде | `true` |
| F1PivotFields | String | Это список ключевых полей, по которым разворачивается сводная таблица. Отсутствующие поля игнорируются, но хотя бы одно поле должно быть определено и существовать в наборе данных. Столбцы исходного шаблона,соответствующие этим полям, удаляются во временном шаблоне, и для каждого из этих полей добавляется отдельная строка шапки. Эти строки размещаются выше и ниже шапки исходного отчета в зависимости от параметра F1PvtSumsInsideOfPivot | marimea |
| F1PivotKeys | String | Это список ключевых полей, по которым группируются входные данные. Отсутствующие поля игнорируются, и при полном отсутствии таких полей сводная таблица будет содержать всего одну строку данных.  Столбцы исходного шаблона, соответствующие этим полям, сохраняются в шаблоне на своем месте | clcdept,comanda,sc,clcsct, rn,desen,colorit,coment,  CLCTEH\_q\_4t |
| F1PivotSums | String | Это список агрегатных \(т.е. количественно-суммовых\) полей, значения которых разносятся по столбцам сводной таблицы в зависимости от значения ключей. Отсутствующие поля игнорируются, но хотя бы одно поле должно быть определено и существовать в наборе данных. Столбцы исходного шаблона,  соответствующие этим полям, дублируются во временном шаблоне, образуя содержимое сводной таблицы.  Для формирования итогов по строке по некоторым из этих полей имена этих полей нужно указать с символом '+' в конце \(слитно\), например: CANT+,SUMA | cant,mp |
| F1PivotTotals | String | Это список агрегатных \(т.е. количественно-суммовых\) полей, значения которых суммируются при группировке входных данных. Отсутствующие поля игнорируются, и их может не быть вовсе. Столбцы исходного шаблона, соответствующие этим полям, сохраняются в шаблоне на своем месте.  Такие поля можно применять для формирования итогов по строке. | cant2,mp2 |
| F1SetColWidthAuto | Boolean | Автоподбор ширины столбцов обычно удобен, но иногда он искажает внешний вид отчета - в этом случае его можно отключить, установив значение этого параметра "`false`" | `true` |
| F1PvtAtlernateMethodic | Boolean | Для большинства отчетов настоятельно рекомендуется устанавливать значение этого параметра "true". Это приведет к использованию более нового и быстрого алгоритма без использования операторов DDL и соответственно без неявных коммитов. | `false` |
| F1PvtBuildAllTotalSums | Boolean | Вместо того, чтобы указать признак генерации итогов по строке для всех столбцов сводной таблицы, можно установить значение этого параметра "`true`" | `false` |
| F1PvtPreserveEmptySums | Boolean | Для уменьшения числа столбцов, те столбцы сводной таблицы, в которые не попадает ни одного значения, удаляются из таблицы. Если же надо выводить все столбцы, включая пустые, можно установить значение этого параметра "true" | `false` |
| F1PvtSumsInsideOfPivot | Boolean | Значение этого параметра легче всего понять на практике. Нормальный режим построения сводной таблицы - каждый столбец отчета, соответствующий агрегатному полю из списка F1PivotSums, превращается в набор столбцов для разных значений ключей.  При этом новые строки шапки добавляются к ней снизу. При установке значения этого параметра "`true`" столбцы сводной таблицы перегруппируются таким образом, чтобы все суммы одного значения ключа оказались рядом. При этом новые строки шапки добавляются к ней сверху. | `false` |
| F1PvtVirtualMergeCells | Boolean | Новые строки шапки почти всегда содержат значения, объединяющие несколько столбцов. Поэтому содержащие их ячейки объединяются для удобства восприятия. Если по каким-то причинам объединение ячеек становится нежелательным, установка значения этого параметра "true" приводит к визуальному объединению ячеек - между ними удаляются разделительные линии, и содержимое всех ячеек, кроме центральной в группе, очищается. Внешне это выглядит как реальное объединение \(особенно для нечетного или достаточно большого количества ячеек\). | `false` |
| F1Pvt\_GroupField | String | Вместо того, чтобы строить шапку значений столбцов сводной таблицы в области заголовка,  ее можно построить в строке группировки по какому-то полю.  Для этого достаточно установить значение этого параметра как имя нужного поля. | clcsct |
| F1Pvt\_TotalsCaption | String | Этот параметр позволяет задать нестандартный заголовок для итоговых  столбцов сводной таблицы \(стандартный заголовок выглядит как "\(...\)"\). |  |
| F1PvtDeleteEmptyGroups | Boolean |  | `true` |
| F1PvtReplaceHeaderText | Boolean |  | `true` |



